
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace Models
{
    public class DIE_EST_DISTRIBUICAO_FILIAL
    {

        [NotMapped]
        public string Trigger_DIE_TRG_BIU_DISTRIB { get; set; } = `{"triggering_event":"INSERT OR UPDATE OR DELETE","trigger_body":"declare\n  cursor C_DISTRIBUICAO(P_DIE_EST_DISTRIBUICAO_ID number) is\n    select BEG_PRODUTO_ID,\n           BEG_PRD_SKU_ID,\n           DIE_EST_DISTRIBUICAO_ID,\n           AD_ORG_ID\n      from DIE_EST_DISTRIBUICAO B\n     where B.DIE_EST_DISTRIBUICAO_ID = P_DIE_EST_DISTRIBUICAO_ID;\n  R_DISTRIBUICAO C_DISTRIBUICAO%rowtype;\n\nbegin\n\n  open C_DISTRIBUICAO(NVL(:new.DIE_EST_DISTRIBUICAO_ID,\n                          :old.DIE_EST_DISTRIBUICAO_ID));\n  fetch C_DISTRIBUICAO\n    into R_DISTRIBUICAO;\n  close C_DISTRIBUICAO;\n\n  if R_DISTRIBUICAO.AD_ORG_ID = 0 then\n    RAISE_APPLICATION_ERROR(-20001, 'Filial * é somadora !');\n  end if;\n\n  if INSERTING then\n  \n    if :new.AD_ORG_ID = R_DISTRIBUICAO.AD_ORG_ID then\n      RAISE_APPLICATION_ERROR(-20001,\n                              'Distribuição deve ser efetuada para outra Filial !');\n    end if;\n  \n    if :new.DATA <= sysdate then\n      RAISE_APPLICATION_ERROR(-20001, 'Data inválida !');\n    end if;\n  \n    if :new.QTD_DISTRIBUIDA <= 0 then\n      RAISE_APPLICATION_ERROR(-20001, 'Quantidade inválida !');\n    end if;\n  \n    update DIE_EST_DISTRIBUICAO A\n       set A.QTD_DISTRIBUIDA = A.QTD_DISTRIBUIDA + :new.QTD_DISTRIBUIDA\n     where A.BEG_PRODUTO_ID = R_DISTRIBUICAO.BEG_PRODUTO_ID\n       and A.BEG_PRD_SKU_ID = R_DISTRIBUICAO.BEG_PRD_SKU_ID\n       and A.DIE_EST_DISTRIBUICAO_ID =\n           R_DISTRIBUICAO.DIE_EST_DISTRIBUICAO_ID;\n  \n    update DIE_EST_DISTRIBUICAO A\n       set A.QTD_A_RECEBER = A.QTD_A_RECEBER + :new.QTD_DISTRIBUIDA\n     where A.BEG_PRODUTO_ID = R_DISTRIBUICAO.BEG_PRODUTO_ID\n       and A.BEG_PRD_SKU_ID = R_DISTRIBUICAO.BEG_PRD_SKU_ID\n       and A.AD_ORG_ID = :new.AD_ORG_ID;\n  \n  end if;\n\n  if UPDATING then\n  \n    if :new.AD_ORG_ID = R_DISTRIBUICAO.AD_ORG_ID then\n      RAISE_APPLICATION_ERROR(-20001,\n                              'Distribuição deve ser efetuada para outra Filial !');\n    end if;\n  \n    update DIE_EST_DISTRIBUICAO A\n       set A.QTD_DISTRIBUIDA = A.QTD_DISTRIBUIDA + :new.QTD_DISTRIBUIDA\n     where A.BEG_PRODUTO_ID = R_DISTRIBUICAO.BEG_PRODUTO_ID\n       and A.BEG_PRD_SKU_ID = R_DISTRIBUICAO.BEG_PRD_SKU_ID\n       and A.DIE_EST_DISTRIBUICAO_ID =\n           R_DISTRIBUICAO.DIE_EST_DISTRIBUICAO_ID;\n  \n    update DIE_EST_DISTRIBUICAO A\n       set A.QTD_DISTRIBUIDA = A.QTD_DISTRIBUIDA - :old.QTD_DISTRIBUIDA\n     where A.BEG_PRODUTO_ID = R_DISTRIBUICAO.BEG_PRODUTO_ID\n       and A.BEG_PRD_SKU_ID = R_DISTRIBUICAO.BEG_PRD_SKU_ID\n       and A.DIE_EST_DISTRIBUICAO_ID =\n           R_DISTRIBUICAO.DIE_EST_DISTRIBUICAO_ID;\n  \n    update DIE_EST_DISTRIBUICAO A\n       set A.QTD_A_RECEBER = A.QTD_A_RECEBER + :new.QTD_DISTRIBUIDA\n     where A.BEG_PRODUTO_ID = R_DISTRIBUICAO.BEG_PRODUTO_ID\n       and A.BEG_PRD_SKU_ID = R_DISTRIBUICAO.BEG_PRD_SKU_ID\n       and A.AD_ORG_ID = :new.AD_ORG_ID;\n  \n    update DIE_EST_DISTRIBUICAO A\n       set A.QTD_A_RECEBER = A.QTD_A_RECEBER - :old.QTD_DISTRIBUIDA\n     where A.BEG_PRODUTO_ID = R_DISTRIBUICAO.BEG_PRODUTO_ID\n       and A.BEG_PRD_SKU_ID = R_DISTRIBUICAO.BEG_PRD_SKU_ID\n       and A.AD_ORG_ID = :old.AD_ORG_ID;\n  \n  end if;\n\n  if DELETING then\n    update DIE_EST_DISTRIBUICAO A\n       set A.QTD_DISTRIBUIDA = A.QTD_DISTRIBUIDA - :old.QTD_DISTRIBUIDA\n     where A.BEG_PRODUTO_ID = R_DISTRIBUICAO.BEG_PRODUTO_ID\n       and A.BEG_PRD_SKU_ID = R_DISTRIBUICAO.BEG_PRD_SKU_ID\n       and A.DIE_EST_DISTRIBUICAO_ID =\n           R_DISTRIBUICAO.DIE_EST_DISTRIBUICAO_ID;\n  \n    update DIE_EST_DISTRIBUICAO A\n       set A.QTD_A_RECEBER = A.QTD_A_RECEBER - :old.QTD_DISTRIBUIDA\n     where A.BEG_PRODUTO_ID = R_DISTRIBUICAO.BEG_PRODUTO_ID\n       and A.BEG_PRD_SKU_ID = R_DISTRIBUICAO.BEG_PRD_SKU_ID\n       and A.AD_ORG_ID = :old.AD_ORG_ID;\n  \n  end if;\nend BEG_TRG_AID_PRD_SKU;\n"}`;
    
    }
}
