
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace Models
{
    public class BEG_CPR_NFE_FISCAL
    {

        [NotMapped]
        public string Trigger_BEG_TRG_BU_NFE_FISCAL { get; set; } = `{"triggering_event":"UPDATE","trigger_body":"declare\n  /* ---------------------------------------------------------------------------------------------------\n   Objetivo(s)..: Trigger de validacoes\n   Modulo.......: FIS - Fiscal\n   Analista.....: Aroldo de Oliveira Krul\n   Alteracoes:\n   Data        Desenvolvedor  Alteracao\n   17/06/2011  Aroldo O.Krul  Criacao.\n   05/09/2011  Aroldo O.Krul  Prever alteracao do cod modelo fiscal não somente o ID\n   09/09/2011  Aroldo O.Krul  Inserido a data de entrada com alteracao no gerencial\n   12/09/2011  Aroldo O.Krul  Alteracao no gerencial quando a chave de acesso for informada\n  --------------------------------------------------------------------------------------------------- */\n  VC_MSG_ERRO varchar2(200);\n\n  -- aok - 05/09/2011\n  cursor C_COD_MOD is\n    select *\n      from BEG_FIS_COD_MODELO CM\n     where CM.BEG_FIS_COD_MODELO_ID = :NEW.BEG_FIS_COD_MODELO_ID;\n  RCM C_COD_MOD%rowtype;\n  --\nbegin\n  --\n  -- Se false goto fim\n  --    RAISE_APPLICATION_ERROR(-20001,\n  --                            'Estou aqui 1 !')  ;\n  if BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL then\n    --VC_MSG_ERRO := 'sai no desvio';\n        BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := false;\n    goto FIM;\n  end if;\n\n  if :NEW.BEG_FIS_COD_MODELO_ID <> :OLD.BEG_FIS_COD_MODELO_ID or\n    :new.chave_nfe <> nvl(:old.chave_nfe,'^') then\n    open C_COD_MOD;\n    fetch C_COD_MOD\n      into RCM;\n    close C_COD_MOD;\n    :NEW.COD_MOD_NF := RCM.VALUE;\n  end if;\n\n  --\n  if :NEW.NUMERO <> :OLD.NUMERO then\n    BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := true;\n    BEG_PCK_CPG_CONTAS_PAGAR.VB_PROC_HIST       := true;\n    update BEG_CPR_NFE N\n       set N.NUMERO    = :NEW.NUMERO,\n           N.UPDATED   = :NEW.UPDATED,\n           N.UPDATEDBY = :NEW.UPDATEDBY\n     where N.BEG_CPR_NFE_ID = :NEW.BEG_CPR_NFE_FISCAL_ID;\n    --\n    update BEG_CPG_TITULO T\n       set T.VALUE     = :NEW.NUMERO,\n           T.UPDATED   = :NEW.UPDATED,\n           T.UPDATEDBY = :NEW.UPDATEDBY\n     where T.BEG_CPR_NFE_ID = :NEW.BEG_CPR_NFE_FISCAL_ID;\n    BEG_PCK_CPG_CONTAS_PAGAR.VB_PROC_HIST       := false;\n    BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := false;\n  end if;\n  --\n  if NVL(:NEW.SERIE, '^') <> NVL(:OLD.SERIE, '^') then\n    BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := true;\n    update BEG_CPR_NFE N\n       set N.SERIE     = :NEW.SERIE,\n           N.UPDATED   = :NEW.UPDATED,\n           N.UPDATEDBY = :NEW.UPDATEDBY\n     where N.BEG_CPR_NFE_ID = :NEW.BEG_CPR_NFE_FISCAL_ID;\n    BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := false;\n  end if;\n  -- aok - 09/09/2011\n  if :NEW.DT_ENTRADA <> :OLD.DT_ENTRADA then\n    BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := true;\n    --\n    update BEG_CPR_NFE N\n       set N.DT_ENTRADA = :NEW.DT_ENTRADA,\n           N.UPDATED    = :NEW.UPDATED,\n           N.UPDATEDBY  = :NEW.UPDATEDBY\n     where N.BEG_CPR_NFE_ID = :NEW.BEG_CPR_NFE_FISCAL_ID;\n    --\n    BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := false;\n  end if;\n  -- aok - 12/09/2011\n  if :NEW.CHAVE_NFE <> nvl(:OLD.CHAVE_NFE,'^') then\n--      RAISE_APPLICATION_ERROR(-20001,\n--                              'Estou aqui 2 !');\n    BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := true;\n    --\n    if RCM.IND_CHAVE_ACESSO = 'N' and :new.chave_nfe is not null then\n      BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := false;\n      RAISE_APPLICATION_ERROR(-20001,\n                              'Código modelo fiscal desobriga a chave de acesso - verifique!');\n    end if;\n    if RCM.IND_CHAVE_ACESSO = 'Y' and :new.chave_nfe is null then\n       BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := false;\n       RAISE_APPLICATION_ERROR(-20002,\n                              'Codigo modelo fiscal  obriga a chave de acesso - veifique!');\n    end if;\n    --\n    update BEG_CPR_NFE N\n       set N.CHAVE_NFE             = :NEW.CHAVE_NFE,\n           N.BEG_FIS_COD_MODELO_ID = :NEW.BEG_FIS_COD_MODELO_ID,\n           N.UPDATED               = :NEW.UPDATED,\n           N.UPDATEDBY             = :NEW.UPDATEDBY\n     where N.BEG_CPR_NFE_ID = :NEW.BEG_CPR_NFE_FISCAL_ID;\n    --\n    BEG_PCK_CPR_COMPRAS.VB_PROC_ACERTO_ESPECIAL := false;\n  end if;\n  --\n  --    VC_MSG_ERRO := 'Valores negativos no calculo do ICMS digitado!';\n  --    goto FIM;\n\n  <<FIM>>\n  if VC_MSG_ERRO is not null then\n    RAISE_APPLICATION_ERROR(-20001, VC_MSG_ERRO);\n  end if;\n  --\nend BEG_TRG_BU_NFE_FISCAL;\n"}`;
    
    }
}
